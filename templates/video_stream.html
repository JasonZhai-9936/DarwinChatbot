<!DOCTYPE html>
<html>
<head><title>Live Stream</title></head>
<body>
  <h2>LivePortrait Streaming</h2>
  <video id="video" width="720" controls autoplay></video>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    if (Hls.isSupported()) {
      const hls = new Hls({
        liveDurationInfinity: true,
        lowLatencyMode: false,
        backBufferLength: 90,
        maxBufferLength: 120,
        maxMaxBufferLength: 120,
        maxBufferSize: 60 * 1000 * 1000,
        maxBufferHole: 0.5,
        enableWorker: true,
        appendErrorMaxRetry: 10,
        fragLoadingTimeOut: 6000,
        manifestLoadingTimeOut: 6000,
        manifestLoadingMaxRetry: 50,
        manifestLoadingRetryDelay: 2000,
        manifestLoadingMaxRetryTimeout: 64000
      });
  
      const video = document.getElementById("video");
      hls.loadSource("/outputs/stream/playlist.m3u8");
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
        hls.startLoad();  // ⬅️ Triggers periodic reloading of playlist
        video.play();
      });
  
      // Optional: Log fragment load to verify updates
      hls.on(Hls.Events.FRAG_LOADED, (event, data) => {
        console.log(`[HLS] Loaded fragment: ${data.frag.sn}`);
      });
    } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
      video.src = "/outputs/stream/playlist.m3u8";
      video.play();
    }
  </script>
  
  <br><a href="/">⬅️ Back</a>
</body>
</html>
